<html>

<body>
    <div　id="menu">
        <div id="side_dishes">

            <input type="checkbox" onclick="onTap(this)" id="gyoza">
            <label id="gyoza_label" for=gyoza>aaa</label>
            <input type="checkbox" onclick="onTap(this)" id="gyoza_vegan">
            <label for=gyoza_vegan></label>

            <br>
            <input type="checkbox" onclick="onTap(this)" id="kimchi">
            <label for=kimchi></label>
            <input type="checkbox" onclick="onTap(this)" id="fried_eryngii">
            <label for=fried_eryngii></label>

            <br>
            <input type="checkbox" onclick="onTap(this)" id="karaage">
            <label for=karaage></label>
            <input type="checkbox" onclick="onTap(this)" id="karaage_V">
            <label for=karaage_V></label>

            <br>
            <input type="checkbox" onclick="onTap(this)" id="Edamame">Edamame 3.9
            <label for=Edamame></label>

            <input type="checkbox" onclick="onTap(this)" id="Wakame_Salad">Wakame Salad 3.5
            <label for=Wakame_Salad></label>
        </div>

        <hr>
        <input type="checkbox" onclick="onTap(this)" id="Shoyu">Shoyu 10.5
        <input type="checkbox" onclick="onTap(this)" id="Shoyu_V">Shoyu_V 10.5

        <br>
        <input type="checkbox" onclick="onTap(this)" id="Torikotsu">Torikotsu 11.5
        <input type="checkbox" onclick="onTap(this)" id="Torikotsu_V">Torikotsu_V 11.5

        <br>
        <input type="checkbox" onclick="onTap(this)" id="Miso">Miso 10.5
        <input type="checkbox" onclick="onTap(this)" id="Miso_V">Miso_V 10.5

        <br>
        <input type="checkbox" onclick="onTap(this)" id="TanTan">TanTan 11.5
        <input type="checkbox" onclick="onTap(this)" id="TanTan_V">TanTan_V 11.5

        <hr>
        <div id="extra_topping_area"></div>

        <hr>
        <div id="dessert_area"></div>

        <hr>
        <div id="warm_drinks_area"></div>

        <hr>
        <div id="cold_drinks_area"></div>


    </div>

    <div id=current_item></div>
    <br>
    <div id="subtotal_display">0</div>
    <br>

    <!-- <button id="subtotal_button" onclick="test()">subtotal</button> -->

    <!-- TODO: gyaza objectととか作って、listに追加するようにする方がいいかなあ？-->
    <!-- TODO: factory.get(Edamame)とか。-->
    <!-- TODO: 小クラスとか作れるんかなあ？SideDishesクラスの小クラスのedamameとか-->

    <script language="javascript" type="text/javascript">

        //TODO: 将来的にはメニューとラベルのの自動生成もしたい。=>addFood()でした。
        const price = {
            "gyoza": 4.5,
            "gyoza_vegan": 5.0,
            "kimchi": 3.7,
            "fried_eryngii": 3.9,
            "karaage": 4.9,
            "karaage_V": 5.5,
            "Edamame": 3.9,
            "Wakame_Salad": 3.5,
            "Shoyu": 10.5,
            "Shoyu_V": 10.5,
            "Torikotsu": 11.5,
            "Torikotsu_V": 11.5,
            "Miso": 10.5,
            "Miso_V": 10.5,
            "TanTan": 11.5,
            "TanTan_V": 11.5
        }

        //ラベルに金額と商品名を自動セット
        let foods = document.querySelectorAll('label');
        foods.forEach(label => label.innerHTML = label.htmlFor + " " + price[label.htmlFor]);



        //下記より新バージョン//

        //メニュー自体の自動生成。まずはextra toppingから。
        const extraToppingPriceList = {
            "egg": 1.0,
            "egg_v": 1.5,
            "naruto": 1.0,
            "naruto_V": 1.5,
            "garlic": 1.0,
            "chashu": 2.0,
            "beyond_meat": 2.0,
            "eryngii": 1.5,
            "big_portion": 3.0
        };

        const dessertPriceList = {
            "mochi": 3.5,
            "stick_ice": 2.5 
        };

        const warmDrinksPriceList = {
            "yuzu": 2.8,
            "plum": 2.8,
            "ginger":2.8,
            "genmaicha":2.8,
            "houjicha":2.8,
        };

        const coldDrinksPriceList = {
            "erdinger": 3.5,
            "cola": 2.8,
            "sprite": 2.8, 
            "ramune": 3.3,
            "greentea": 3.5,
            "aloe": 3.3,
            "peach_mango_melon_soda": 3.3,
            "mugicha": 3.5,
            "calpico": 3.0,
            "water": 2.8
        };

        const otherPriceList = {

        };


        //add to global price list.
        //TODO: なんかこれ列挙してるのきれいではないわ。。。。
        Object.assign(price, extraToppingPriceList);
        Object.assign(price, dessertPriceList);
        Object.assign(price, warmDrinksPriceList);
        Object.assign(price, coldDrinksPriceList);
        Object.assign(price, otherPriceList);


        // add food
        function addFood(area, priceList) {
            for (let [key, value] of Object.entries(priceList)) {
                let food = document.createElement("Input");
                food.setAttribute("type", "checkbox");
                food.setAttribute("onclick", "onTap(this)");
                food.setAttribute("id", key)
                area.appendChild(food);

                let label = document.createElement("Label");
                label.setAttribute("for", key);
                label.innerHTML = key + " " + value;
                area.appendChild(label);

                // const br = document.createElement("br"); 
                // extraToppingArea.appendChild(br);
            }
        }


        //TODO: これ以降も自動化したい
        // add item for extra toppings
        let extraToppingArea = document.querySelector("#extra_topping_area");
        addFood(extraToppingArea, extraToppingPriceList);

        // add item for desert
        let dessertArea = document.querySelector("#dessert_area");
        addFood(dessertArea, dessertPriceList);

        // add item for warm drinks
        let warmDrinksArea = document.querySelector("#warm_drinks_area");
        addFood(warmDrinksArea, warmDrinksPriceList);

        // add item for cold drinks
        let coldDrinksArea = document.querySelector("#cold_drinks_area");
        addFood(coldDrinksArea, coldDrinksPriceList);


        //subtotal area
        let subtotalDisplay = document.querySelector("#subtotal_display");
        let currentItemDisplay = document.querySelector("#current_item");

        // calculation
        function onTap(elem) {

            const itemName = elem.id
            const itemPrice = price[itemName];

            if (elem.checked) {
                subtotalDisplay.innerText = parseFloat(subtotalDisplay.innerText) + itemPrice;

                currentItemDisplay.innerText = "last: " + itemName + ":" + itemPrice;
            } else {
                subtotalDisplay.innerText = parseFloat(subtotalDisplay.innerText) - itemPrice;
                currentItemDisplay.innerText = "";
            }
            console.log(subtotalDisplay.innerText);
        }


        // function test() {
        //     subtotalDisplay.innerText = parseFloat(subtotalDisplay.innerText) + 2.5;
        //     console.log(subtotalDisplay.innerText);
        // }

    </script>

</body>

</html>